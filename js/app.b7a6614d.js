(function(t){function e(e){for(var i,s,o=e[0],h=e[1],u=e[2],d=0,c=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&c.push(n[s][0]),n[s]=0;for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(t[i]=h[i]);l&&l(e);while(c.length)c.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],i=!0,o=1;o<a.length;o++){var h=a[o];0!==n[h]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var i={},n={app:0},r=[];function s(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=i,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/ask-the-crowd/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],h=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=h;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"App"},[a("div",{class:t.contentClasses,on:{click:t.startLoadingFile,drop:t.onDropFile,dragenter:t.onDragEnter,dragleave:t.onDragLeave,dragover:t.onDragOver}},["comment"===t.type?[a("div",{staticClass:"App__title"},[t._v(t._s(t.question))]),t.image_url?a("div",{staticClass:"App__image"},[a("div",{staticClass:"App__image-container",style:{backgroundImage:"url("+t.image_url+")"}})]):t._e(),a("div",{staticClass:"App__responses"},t._l(t.responses,(function(e){return a("div",{staticClass:"App__responses-item"},[t._v(" "+t._s(e.comment)+" ")])})),0)]:t._e(),"heatmap"===t.type?[a("div",{staticClass:"App__title"},[t._v(t._s(t.question))]),a("div",{staticClass:"App__heatmap"},[a("div",{staticClass:"App__heatmap-image"},[a("img",{ref:"heatmap-image",attrs:{src:t.image_url}}),a("div",{ref:"heatmap-map",staticClass:"App__heatmap-image-map"}),a("div",{ref:"heatmap-stats",staticClass:"App__heatmap-image-stats"})])]),a("div",{staticClass:"App__heatmap-timeline"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.currentDuration,expression:"currentDuration"}],ref:"heatmap-range",staticClass:"App__heatmap-timeline-range",attrs:{type:"range",min:"0",max:t.maxDuration},domProps:{value:t.currentDuration},on:{__r:function(e){t.currentDuration=e.target.value}}}),a("div",{ref:"heatmap-range-current",staticClass:"App__heatmap-timeline-current"},[t._v(t._s(t.maxDuration)+" сек.")])]),a("div",{staticClass:"App__heatmap-median"},[t._v(" Среднее время клика (медиана): "+t._s(t.click_median)+" сек. ")])]:t._e(),null===t.type?[a("div",{staticClass:"App__upload"},[t._v("Нажмите для загрузки файла")]),a("input",{ref:"file",staticClass:"App__upload-file",attrs:{type:"file",name:"file"},on:{change:t.getFileContent}})]:t._e()],2)])},r=[],s=(a("4de4"),a("4160"),a("d81d"),a("159b"),a("6bc1")),o=a.n(s),h=a("d4ec"),u=a("bee2"),l=function(){function t(e,a,i){Object(h["a"])(this,t),this.startX=e,this.startY=a,this.endX=e+32,this.endY=a+24,this.total=i}return Object(u["a"])(t,[{key:"expandTo",value:function(t,e){this.endX=Math.max(t,this.startX+32),this.endY=Math.max(e,this.startY+24),this.setCSS()}},{key:"cointainsPoint",value:function(t){return t.x>=this.startX&&t.x<=this.endX&&t.y>=this.startY&&t.y<=this.endY}},{key:"setCSS",value:function(){this.el&&(this.el.style.left=this.startX+"px",this.el.style.top=this.startY+"px",this.el.style.width=this.endX-this.startX+"px",this.el.style.height=this.endY-this.startY+"px")}},{key:"getPoints",value:function(){return this.points}},{key:"setPoints",value:function(t){this.text.innerHTML="".concat(Math.floor(100*t/this.total),"%")}},{key:"createEl",value:function(){this.el=document.createElement("div"),this.el.classList.add("area")}},{key:"createClose",value:function(){var t=this;this.close=document.createElement("div"),this.close.classList.add("area__close"),this.close.innerHTML="×",this.el.append(this.close),this.close.addEventListener("click",(function(e){t.el.remove()})),this.close.addEventListener("mousedown",(function(t){t.stopPropagation()}))}},{key:"createText",value:function(){this.text=document.createElement("div"),this.text.classList.add("area__text"),this.el.append(this.text)}},{key:"render",value:function(){return this.createEl(),this.createText(),this.createClose(),this.setCSS(),this.el}}]),t}(),d=l;function c(t){if(0===t.length)return 0;t.sort((function(t,e){return t-e}));var e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2}var p={name:"App",data:function(){return{type:null,question:null,image_url:null,responses:null,heatmap:null,currentDuration:0,maxDuration:0,dragOver:!1}},computed:{click_median:function(){var t=c(this.responses.map((function(t){return t.duration})));return Math.round(t/10)/100},contentClasses:function(){return{App__content:!0,App__content_over:this.dragOver}}},methods:{getFileContent:function(){var t=this.$refs.file.files[0];t&&this.parseAndAssignFileContent(t)},startLoadingFile:function(){this.type||this.$refs.file.click()},renderHeatmap:function(){var t,e,a=this,i=this.$refs["heatmap-image"],n=this.responses.map((function(t){var e=JSON.parse(t.point);return{left:e[0],top:e[1],time:Math.round(t.duration/1e3)}}));n.forEach((function(t){t.time>a.maxDuration&&(a.maxDuration=t.time)})),this.currentDuration=this.maxDuration;var r=function(i){a.heatmap||(a.heatmap=o.a.create({container:a.$refs["heatmap-map"],radius:24}));var r=n.filter((function(t){return t.time<=i})).map((function(a){return{x:Math.round(t*a.left),y:Math.round(e*a.top),value:1}}));window.surveyPointsData=r,a.heatmap.setData({max:5,data:r})};i.addEventListener("load",(function(){t=i.getBoundingClientRect().width,e=i.getBoundingClientRect().height,r(a.maxDuration)}));var s=document.createElement("img");s.src=i.src,s.addEventListener("load",(function(){t=i.getBoundingClientRect().width,e=i.getBoundingClientRect().height,r(a.maxDuration)})),s.style.height="0px",document.body.append(s);var h=this.$refs["heatmap-stats"];if(h){var u=function(t){return t.clientY-h.getBoundingClientRect().top},l=function(t){return t.clientX-h.getBoundingClientRect().left};h.addEventListener("mousedown",(function(t){var e=new d(l(t),u(t),window.surveyPointsData.length);h.append(e.render());var a=function(t){e.expandTo(l(t),u(t));var a=window.surveyPointsData.filter((function(t){return e.cointainsPoint(t)})).length;e.setPoints(a)},i=function t(e){a(e),h.removeEventListener("mousemove",a,!1),h.removeEventListener("mouseup",t,!1)};h.addEventListener("mousemove",a,!1),h.addEventListener("mouseup",i,!1)}))}var c=this.$refs["heatmap-range"],p=this.$refs["heatmap-range-current"],_=function(){var t=parseInt(c.value,10);p.innerHTML=t+" сек.",p.style.left=Math.round(100*t/parseInt(c.max,10))+"%",r(t)};c.addEventListener("change",_),c.addEventListener("input",_)},onDropFile:function(t){t.preventDefault(),this.dragOver=!1;var e=t.dataTransfer.files[0];this.parseAndAssignFileContent(e)},onDragEnter:function(t){t.preventDefault(),this.dragOver=!0},onDragOver:function(t){t.preventDefault(),this.dragOver=!0},onDragLeave:function(t){t.preventDefault(),this.dragOver=!1},parseAndAssignFileContent:function(t){var e=this,a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=function(t){var a=JSON.parse(t.target.result);e.type=a.answer_type,e.question=a.question,e.image_url=a.image_url,e.responses=a.responses,"heatmap"==e.type&&e.$nextTick(e.renderHeatmap)}}}},_=p,f=(a("5c0b"),a("2877")),m=Object(f["a"])(_,n,r,!1,null,null,null),g=m.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(g)}}).$mount("#app")},"5c0b":function(t,e,a){"use strict";a("9c0c")},"6bc1":function(t,e,a){var i,n;a("cb29"),a("b64b"),a("ac1f"),a("5319"),function(r,s,o){t.exports?t.exports=o():(i=o,n="function"===typeof i?i.call(e,a,e,t):i,void 0===n||(t.exports=n))}(0,0,(function(){var t={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},e=function(){var e=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=t["xField"]||t.defaultXField,this._yField=t["yField"]||t.defaultYField,this._valueField=t["valueField"]||t.defaultValueField,t["radius"]&&(this._cfgRadius=t["radius"])},a=t.defaultRadius;return e.prototype={_organiseData:function(t,e){var i=t[this._xField],n=t[this._yField],r=this._radi,s=this._data,o=this._max,h=this._min,u=t[this._valueField]||1,l=t.radius||this._cfgRadius||a;s[i]||(s[i]=[],r[i]=[]),s[i][n]?s[i][n]+=u:(s[i][n]=u,r[i][n]=l);var d=s[i][n];return d>o?(e?this.setDataMax(d):this._max=d,!1):d<h?(e?this.setDataMin(d):this._min=d,!1):{x:i,y:n,value:u,radius:l,min:h,max:o}},_unOrganizeData:function(){var t=[],e=this._data,a=this._radi;for(var i in e)for(var n in e[i])t.push({x:i,y:n,radius:a[i][n],value:e[i][n]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0){var t=arguments[0],e=t.length;while(e--)this.addData.call(this,t[e])}else{var a=this._organiseData(arguments[0],!0);a&&(0===this._data.length&&(this._min=this._max=a.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[a]}))}return this},setData:function(t){var e=t.data,a=e.length;this._data=[],this._radi=[];for(var i=0;i<a;i++)this._organiseData(e[i],!1);return this._max=t.max,this._min=t.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},e}(),a=function(){var t=function(t){var e=t.gradient||t.defaultGradient,a=document.createElement("canvas"),i=a.getContext("2d");a.width=256,a.height=1;var n=i.createLinearGradient(0,0,256,1);for(var r in e)n.addColorStop(r,e[r]);return i.fillStyle=n,i.fillRect(0,0,256,1),i.getImageData(0,0,256,1).data},e=function(t,e){var a=document.createElement("canvas"),i=a.getContext("2d"),n=t,r=t;if(a.width=a.height=2*t,1==e)i.beginPath(),i.arc(n,r,t,0,2*Math.PI,!1),i.fillStyle="rgba(0,0,0,1)",i.fill();else{var s=i.createRadialGradient(n,r,t*e,n,r,t);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(1,"rgba(0,0,0,0)"),i.fillStyle=s,i.fillRect(0,0,2*t,2*t)}return a},a=function(t){var e=[],a=t.min,i=t.max,n=t.radi,r=(t=t.data,Object.keys(t)),s=r.length;while(s--){var o=r[s],h=Object.keys(t[o]),u=h.length;while(u--){var l=h[u],d=t[o][l],c=n[o][l];e.push({x:o,y:l,value:d,radius:c})}}return{min:a,max:i,data:e}};function i(e){var a=e.container,i=this.shadowCanvas=document.createElement("canvas"),n=this.canvas=e.canvas||document.createElement("canvas"),r=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(e.container)||{});n.className="heatmap-canvas",this._width=n.width=i.width=e.width||+r.width.replace(/px/,""),this._height=n.height=i.height=e.height||+r.height.replace(/px/,""),this.shadowCtx=i.getContext("2d"),this.ctx=n.getContext("2d"),n.style.cssText=i.style.cssText="position:absolute;left:0;top:0;",a.style.position="relative",a.appendChild(n),this._palette=t(e),this._templates={},this._setStyles(e)}return i.prototype={renderPartial:function(t){t.data.length>0&&(this._drawAlpha(t),this._colorize())},renderAll:function(t){this._clear(),t.data.length>0&&(this._drawAlpha(a(t)),this._colorize())},_updateGradient:function(e){this._palette=t(e)},updateConfig:function(t){t["gradient"]&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,e){this._width=t,this._height=e,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=e},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=t.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=t.height||this._height,this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity),this._useGradientOpacity=!!t.useGradientOpacity},_drawAlpha:function(t){var a=this._min=t.min,i=this._max=t.max,n=(t=t.data||[],t.length),r=1-this._blur;while(n--){var s,o=t[n],h=o.x,u=o.y,l=o.radius,d=Math.min(o.value,i),c=h-l,p=u-l,_=this.shadowCtx;this._templates[l]?s=this._templates[l]:this._templates[l]=s=e(l,r);var f=(d-a)/(i-a);_.globalAlpha=f<.01?.01:f,_.drawImage(s,c,p),c<this._renderBoundaries[0]&&(this._renderBoundaries[0]=c),p<this._renderBoundaries[1]&&(this._renderBoundaries[1]=p),c+2*l>this._renderBoundaries[2]&&(this._renderBoundaries[2]=c+2*l),p+2*l>this._renderBoundaries[3]&&(this._renderBoundaries[3]=p+2*l)}},_colorize:function(){var t=this._renderBoundaries[0],e=this._renderBoundaries[1],a=this._renderBoundaries[2]-t,i=this._renderBoundaries[3]-e,n=this._width,r=this._height,s=this._opacity,o=this._maxOpacity,h=this._minOpacity,u=this._useGradientOpacity;t<0&&(t=0),e<0&&(e=0),t+a>n&&(a=n-t),e+i>r&&(i=r-e);for(var l=this.shadowCtx.getImageData(t,e,a,i),d=l.data,c=d.length,p=this._palette,_=3;_<c;_+=4){var f,m=d[_],g=4*m;if(g)f=s>0?s:m<o?m<h?h:m:o,d[_-3]=p[g],d[_-2]=p[g+1],d[_-1]=p[g+2],d[_]=u?p[g+3]:f}l.data=d,this.ctx.putImageData(l,t,e),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var e,a=this.shadowCtx,i=a.getImageData(t.x,t.y,1,1),n=i.data[3],r=this._max,s=this._min;return e=Math.abs(r-s)*(n/255)>>0,e},getDataURL:function(){return this.canvas.toDataURL()}},i}(),i=function(){var e=!1;return"canvas2d"===t["defaultRenderer"]&&(e=a),e}(),n={merge:function(){for(var t={},e=arguments.length,a=0;a<e;a++){var i=arguments[a];for(var n in i)t[n]=i[n]}return t}},r=function(){var a=function(){function t(){this.cStore={}}return t.prototype={on:function(t,e,a){var i=this.cStore;i[t]||(i[t]=[]),i[t].push((function(t){return e.call(a,t)}))},emit:function(t,e){var a=this.cStore;if(a[t])for(var i=a[t].length,n=0;n<i;n++){var r=a[t][n];r(e)}}},t}(),r=function(t){var e=t._renderer,a=t._coordinator,i=t._store;a.on("renderpartial",e.renderPartial,e),a.on("renderall",e.renderAll,e),a.on("extremachange",(function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config["gradient"]||t._config["defaultGradient"]})})),i.setCoordinator(a)};function s(){var s=this._config=n.merge(t,arguments[0]||{});if(this._coordinator=new a,s["plugin"]){var o=s["plugin"];if(!t.plugins[o])throw new Error("Plugin '"+o+"' not found. Maybe it was not registered.");var h=t.plugins[o];this._renderer=new h.renderer(s),this._store=new h.store(s)}else this._renderer=new i(s),this._store=new e(s);r(this)}return s.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=n.merge(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},s}(),s={create:function(t){return new r(t)},register:function(e,a){t.plugins[e]=a}};return s}))},"9c0c":function(t,e,a){}});
//# sourceMappingURL=app.b7a6614d.js.map